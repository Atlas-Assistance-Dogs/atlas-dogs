minimum_cumulusci_version: "3.26.0"
project:
    name: atlas-dog
    package:
        name: atlas-dogs
        api_version: "50.0"
    dependencies:
        - github: "https://github.com/SalesforceFoundation/NPSP"
    git:
    source_format: sfdx

tasks:
    robot:
        options:
            suites: robot/atlas-dog/tests
            options:
                outputdir: robot/atlas-dog/results

    robot_testdoc:
        options:
            path: robot/atlas-dog/tests
            output: robot/atlas-dog/doc/atlas-dog_tests.html

    run_tests:
        options:
            required_org_code_coverage_percent: 15

flows:
    dependencies:
        steps:
            1:
                task: update_dependencies
                options:
                    include_beta: False
    config_qa:
        steps:
            1:
                task: dx_push
                when: org_config.scratch
            2:
                task: assign_permission_sets
                options:
                    api_names: Atlas_Super_User
            3:
                task: load_dataset
    config_dev:
        steps:
            1:
                task: dx_push
                when: org_config.scratch
            2:
                task: assign_permission_sets
                options:
                    api_names: AtlasSuperUser
            3:
                task: load_dataset

    dev_org:
        steps:
            2:
                flow: None

    # Flow to deploy current source to a sandbox for dev or verification
    sandbox:
        steps:
            1:
                #     flow: dependencies
                # 2:
                task: dx
                options:
                    command: force:source:deploy
                    extra: -p force-app/main/default
